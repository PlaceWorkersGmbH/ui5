/*!
 * @copyright@
 */
sap.ui.define(['jquery.sap.global','sap/ui/commons/DropdownBox','sap/ui/commons/TextView','sap/ui/commons/Link','sap/ui/commons/Splitter','sap/ui/commons/layout/AbsoluteLayout','sap/ui/core/ListItem','sap/ui/core/search/OpenSearchProvider','./Tag','./TagCloud','./library','sap/ui/ux3/NavigationItem','sap/ui/ux3/Shell'],function(q,D,T,L,S,A,a,O,b,c,l,N,d){"use strict";var f=function(t,v,e){var g=this;function h(p){return p.split('/').slice(0,-1).join('/')+'/';}var B=window.location.href;if(B.indexOf('#')>=0){B=B.slice(0,B.indexOf('#'));}this.sBaseUrl=h(B);this.sBasePathname=h(window.location.pathname);this._iPendingCalls=0;this._mBestMatchingPage={};this._aTopLevelNavItems=[];this._aThemes=e||["sap_bluecrystal","sap_goldreflection","sap_hcb"];this._sTheme=this._aThemes[0];this._sCurrentContent=null;this._mAliases={};this._bIgnoreIFrameOnLoad=false;this._sTitleStr=t;this._sVersionStr=v;this._sSelectedWorkSetItem=null;f.getInstance=q.sap.getter(this);q(window).bind('hashchange',function(){var H=window.location.hash;q.sap.log.debug("hashchange occured, current='"+g._sCurrentContent+"', new='"+H+"'");if(H&&H!="#"+g._sCurrentContent){q.sap.log.info("navigate to "+H);g.navigateTo(H,true);}});};f.getInstance=function(){var t=q.sap.getObject("top.sap.ui.demokit.DemokitApp");if(t&&t!=f){return t.getInstance();}};f.prototype.calcRelativeUrl=function(u){return u.indexOf(this.sBaseUrl)==0?u.substring(this.sBaseUrl.length):null;};f.prototype.registerPageForType=function(u,C){this._mBestMatchingPage[C[0]]=u;};f.prototype.findPageForType=function(t){return this._mBestMatchingPage[t]||"docs/api/symbols/"+t+".html";};f.prototype._addPendingCall=function(){this._iPendingCalls++;};f.prototype._removePendingCall=function(){this._iPendingCalls--;};f.prototype.addIndex=function(i,s){s=s||{};var t=this;var o={id:"mi-"+i,text:s.caption||i,newWindow:s.newWindow,visible:(typeof s.visible==="boolean")?s.visible:true,themable:s.themable||false};this._aTopLevelNavItems.push(o);this._createWorksetItem(o);if(s.index){if(s.extend){s.extend(s.index,function(e){t._setIndexData(i,e);});}else{t._setIndexData(i,s.index);}}else if(s.url){this._loadIndexFromUrl(i,s.url,s.transformer,s.extend);}};f.prototype._loadIndexFromUrl=function(i,u,t,E){var g=this;q.ajax({url:u,dataType:u.slice(-4)==".xml"?"xml":"json",error:function(x,s,e){g._removePendingCall();q.sap.log.error("failed to load index '"+i+"' from '"+u+"': "+s+", "+e);var o=g._findIndexById(i);if(o){o.navItem.setVisible(false);}},success:function(o,s,x){var I=t?t.call(this,o):o;if(E){E(I,function(o){g._removePendingCall();g._setIndexData(i,o);});}else{g._removePendingCall();g._setIndexData(i,I);}}});this._addPendingCall();};f.prototype._setIndexData=function(I,o){var t=this;function p(g){n++;if(g.ref&&g.controls){var C=q.isArray(g.controls)?g.controls:g.controls.split(/,/);t.registerPageForType(g.ref,C);}if(g.alias&&g.ref){var h=g.alias.split(",");for(var i=0;i<h.length;i++){t._mAliases[h[i]]=g.ref;}}if(g.links){for(var i=0;i<g.links.length;i++){p(g.links[i]);}}}var e=this._findIndexById(I);if(e){e.ref=o.ref;e.links=o;var n=0;p(o);e._iTreeSize=n;this._createNavigationTree(e);e.navItem.setEnabled(!!e._oTree);e.navItem.setHref(o.ref);}};f.prototype._findIndexById=function(I){for(var i=0;i<this._aTopLevelNavItems.length;i++){var t=this._aTopLevelNavItems[i];if(t.id==="mi-"+I){return t;}}};f.prototype.getInitialPage=function(s,e){var i=s,h=window.location.hash,m=q.sap.getUriParameters().get("optimized-module-set");function g(u){return/^([a-zA-Z0-9-_]+\/)*[a-zA-Z0-9-_.]+\.html(#.*)?$/.test(u);}if(h){h=h.indexOf("#")===0?h.substring(1):h;if(g(h)){i=h;}}if(e&&m){i="customize.html?data="+m;}return i;};f.prototype.getPagesForCategory=function(C){var t=this._findIndexById("controls");if(!t||!t.links){return f.RETRY_LATER;}var p=C.split('/');var o=t.links;for(var i=0;i<p.length;i++){var P=p[i];for(var j=0;j<o.links.length;j++){if(P==o.links[j].text){break;}}if(j==o.links.length){return[];}o=o.links[j];}return o.links||[];};f.RETRY_LATER=-2;f.prototype.findIndexForPage=function(u){function e(n,u){if(u&&n.ref&&u.indexOf(n.ref)===0){return true;}if(n.links){for(var j=0;j<n.links.length;j++){if(e(n.links[j],u)){return true;}}}return false;}for(var i=0;i<this._aTopLevelNavItems.length;i++){if(this._aTopLevelNavItems[i].links&&e(this._aTopLevelNavItems[i].links,u)){return i;}}if(this._aTopLevelNavItems.length===0||this._iPendingCalls>0){return f.RETRY_LATER;}else{q.sap.log.error("could not find "+u+" in nav tree");return-1;}};f.DEFAULT_TLN_ITEM=0;f.prototype._createNavigationTree=function(t){var e=this;var n=0;function s(E){var C=E.getSource().getCustomData();for(var i in C){if(C[i].getKey()=="_ref_"){e.navigateTo(C[i].getValue());}}}function g(p,r,u,v){for(var i=0;i<r.length;i++){var C={text:r[i].text,tooltip:r[i].tooltip,expanded:u<1,selectable:!!r[i].ref,selected:s};C._ref_=r[i].ref;C.parentName=(u<1)?r[i].text:v+"."+r[i].text;p.push(C);n++;if(r[i].links&&r[i].links.length>0){C.nodes=[];g(C.nodes,r[i].links,u+1,C.parentName);}}}if(t._oTree){return;}var o=new sap.ui.commons.Tree(t.id+"-index",{showHeader:false,width:"100%",height:"100%",showHorizontalScrollbar:true});o.addStyleClass("sapUiTreeWithHeader");var h=new sap.ui.commons.TreeNode({text:"{text}",tooltip:"{tooltip}",expanded:"{expanded}",selectable:"{selectable}",selected:s});var j=new sap.ui.core.CustomData({key:"_ref_",value:"{_ref_}"});h.addCustomData(j);var k=new sap.ui.core.CustomData({key:"parentName",value:"{parentName}"});h.addCustomData(k);var m=[];g(m,t.links.links,0,"");var J=new sap.ui.model.json.JSONModel();J.setSizeLimit(n);o.setModel(J);J.setData(m);o.bindNodes("/",h);if(m.length>25){o.collapseAll();}t._oTree=o;t._iTreeSize=n;t._oEmptyTreeLabel=new sap.ui.commons.Label({text:"No matching entry found.",visible:false,width:"100%",textAlign:"Center"});};f.prototype._createWorksetItem=function(t){var n=t.navItem=new N({key:t.id,text:t.text,href:"#"+t.ref,visible:t.visible,enabled:false});n._itemData_=t;if(this._oShell){this._oShell.addWorksetItem(n);}};f.prototype.createUI=function(s,I){var e;var t=this;var g="theme/img/themeswitch_";var h=f.THEMES;this._oThemeSwitch=new D({change:[this._handleThemeChanged,this],items:q.map(this._aThemes,function(i){return new a({text:h[i],key:i});}),value:h[this._sTheme]});this._oThemeSwitchPopup=new sap.ui.ux3.ToolPopup({title:"Select a theme",icon:g+"regular.png",iconHover:g+"hover.png",iconSelected:g+"selected.png",content:[this._oThemeSwitch],initialFocus:this._oThemeSwitch});var C=new sap.ui.core.HTML("content",{content:"<iframe id=\"content\" name=\"content\" src=\"about:blank\" frameborder=\"0\" onload=\"sap.ui.demokit.DemokitApp.getInstance().onContentLoaded();\"></iframe>"});var o=this._oSidePanelLayout=new A();sap.ui.Device.os.name==sap.ui.Device.os.OS.IOS?e=true:e=false;var j;if(!this._sVersionStr||(this._sVersionStr.indexOf("SNAPSHOT")>-1)||(this._sVersionStr.split(".").length>1&&parseInt(this._sVersionStr.split(".")[1],10)%2===1)){j=new T({text:"Development version! Work in Progress!",semanticColor:sap.ui.commons.TextViewColor.Negative,design:sap.ui.commons.TextViewDesign.Bold});}var v=new L({text:this._sVersionStr,tooltip:"Open Version Info",press:function(){t.navigateTo("versioninfo.html");}});var k=this._oShell=new d({appTitle:this._sTitleStr,showLogoutButton:false,showFeederTool:false,applyContentPadding:false,showSearchTool:s,fullHeightContent:true,toolPopups:[this._oThemeSwitchPopup],search:function(E){t.navigateTo("search.html?q="+encodeURIComponent(E.getParameter("text")));t._oShell._getSearchTool().close();},worksetItemSelected:function(E){var i=E.getParameter("item");if(i.getEnabled()){var p=i._itemData_;if(p.newWindow){E.preventDefault();}t.navigateTo(p.ref,null,null,p.newWindow);}else{E.preventDefault();}},content:[new S("demokitSplitter",{width:"100%",height:"100%",splitterPosition:"0%",splitterBarVisible:false,firstPaneContent:[o],secondPaneContent:[C],showScrollBars:e})],headerItems:j?[j,v]:[v]});this._oShell.addStyleClass("sapDkShell");function m(K){var p=new c({minFontSize:15,maxFontSize:30,press:function(E){var r=sap.ui.getCore().byId(E.getParameter("tagId")).getText();k.fireSearch({text:r});}}).addStyleClass("grTagCloud");for(var i=0;i<K.length;i++){p.addTag(new b({text:K[i].tag,weight:K[i].score}));}k._getSearchTool&&k._getSearchTool().addContent(p);}if(s){var n=k.getSearchField();n.setEnableListSuggest(true);n.setShowListExpander(false);n.setVisibleItemCount(5);n.setSearchProvider(new O({suggestType:"json",suggestUrl:"suggest?q={searchTerms}"}));q.ajax({url:"keywords?kind=tags&max=50",dataType:"json",success:function(i,p,x){if(i&&i[0]&&i[0].success&&i[0].keywords&&i[0].keywords.length){m(i[0].keywords);n.setWidth("80%");}}});}q.each(this._aTopLevelNavItems,function(i,p){k.addWorksetItem(p.navItem);});this.navigateTo(I);q(function(){q("body").append("<div id=\"logo\"><img id=\"logoico\"><img id=\"logotxt\"></div>");q("#logoico").attr("src","resources/sap/ui/core/mimes/logo/icotxt_white_220x72_blue.png").addClass("sapUiImg");});};f.prototype.placeAt=function(i){this._oShell.placeAt(i);};f.prototype.onContentLoaded=function(e){var t=this;var C=q("#content")[0].contentWindow;var i=this.calcRelativeUrl(C.location.href);if(i&&!this._bIgnoreIFrameOnLoad){this.navigateTo(i,true,true);window.location.replace("#"+i);}this._applyTheme();this._bIgnoreIFrameOnLoad=false;q(C).bind("hashchange",function(){var i=t.calcRelativeUrl(C.location.href);if(i&&!t._bIgnoreIFrameOnLoad){t.navigateTo(i,true,true);window.location.hash=i;}t._bIgnoreIFrameOnLoad=false;});};f.prototype.navigateTo=function(n,s,e,g){var t=this;var h="0px";var k="32px";var m="30px";var o="0px";var p="0px";var P=n.indexOf("#")===0?n.substring(1):n;var r=this._mAliases[P];if(r&&P!=r){e=false;P=r;}if(this._sCurrentContent==P){return;}var C=q("#content")[0];var u=C&&C.contentWindow;var v=this.findIndexForPage(P);if(g){window.open(P,"_blank");return;}if(!u||v===f.RETRY_LATER){setTimeout(function(){t.navigateTo(P,s,e);},200);return;}var w=v>=0?this._aTopLevelNavItems[v]:null;var x=this._oShell;var y=sap.ui.getCore().byId("demokitSplitter");if(w&&w._iTreeSize<=1){if(y.getSplitterBarVisible()){var z=y.getSplitterPosition();if(z!=="0%"){y._oldPos=z;y.setSplitterPosition("0%");}y.setSplitterBarVisible(false);}}else{if(!y.getSplitterBarVisible()){var z=y._oldPos||"20%";y.setSplitterPosition(z);y.setSplitterBarVisible(true);}}this._sCurrentContent=P;function B(P,W,X){if(W){if(X&&W.getSelectedNode&&W.getSelectedNode()){W.getSelectedNode().setIsSelected(false);}var Y=W.getNodes();for(var i=0;i<Y.length;i++){var Z=Y[i].getCustomData();var $=false;for(var j in Z){if(Z[j].getKey()=="_ref_"&&Z[j].getValue()&&Z[j].getValue().indexOf(P)>=0){$=true;break;}}if($){Y[i].setIsSelected(true);var _=W;while(_ instanceof sap.ui.commons.TreeNode){_.expand();_=_.getParent();}return Y[i];}else{var a1=B(P,Y[i],false);if(a1){return a1;}}}}return null;}function E(M,j){var W=function(M,Y,j){var Z=[];var $=new sap.ui.model.Filter("parentName",sap.ui.model.FilterOperator.Contains,Y);Z.push($);var _=M.getBinding("nodes");_.filter(Z);if(Y!==""){M.expandAll();}var a1=(M.getNodes().length===0);M.setVisible(!a1);j.setVisible(a1);};var X=new sap.ui.commons.SearchField({enableListSuggest:false,enableClear:true,enableFilterMode:true,startSuggestion:0,suggest:function(Y){W(M,Y.getParameter("value"),j);}});X.addEventDelegate({onAfterRendering:function(){X._ctrl.$("searchico").addClass('sapUiIcon sapUiSearchFieldFilterIcon');X._ctrl.$("searchico").attr('style','font-family: SAP-icons; cursor: default;');X._ctrl.$("searchico").attr('data-sap-ui-icon-content','');}});X._ctrl.setPlaceholder("Filter");X.addStyleClass("sapUiDemokitAbsLayoutFirtsRow sapUiDemokitSearchField");return X;}function F(M,j,W,X,Y){var Z=new sap.ui.commons.Button({lite:true,icon:W,press:j.bind(M)});Z.addStyleClass("sapUiDemokitExpandCollapseButtons sapUiDemokitAbsLayoutFirtsRow");if(Y){Z.addStyleClass(Y);}Z.setTooltip(X);Z.addEventDelegate({onAfterRendering:function(){Z.$("icon").attr("title",X);Z.$("icon").attr("aria-label",X);}});return Z;}function G(M){return F(M,M.collapseAll,"sap-icon://collapse-group","Collapse All","sapUiDemokitCollapseButton");}function H(M){return F(M,M.expandAll,"sap-icon://expand-group","Expand All");}var I=null;var J=w&&w.navItem;if(J&&this._sSelectedWorkSetItem!=J.getId()){J.setVisible(true);x.setSelectedWorksetItem(J);this._oSidePanelLayout.removeAllContent();if(w._oTree){this._oSidePanelLayout.addContent(E(w._oTree,w._oEmptyTreeLabel));this._oSidePanelLayout.addContent(G(w._oTree),{right:o,top:p});this._oSidePanelLayout.addContent(H(w._oTree),{right:m,top:p});this._oSidePanelLayout.addContent(w._oTree,{left:h,top:k});this._oSidePanelLayout.addContent(w._oEmptyTreeLabel,{left:h,top:k});}I=B(P,w._oTree,true);if(w.themable){if(x.getToolPopups().length==0){x.addToolPopup(this._oThemeSwitchPopup);}}else{x.removeAllToolPopups();}}else{var K=this._oSidePanelLayout.getContent();var M;for(var i in K){if(K[i].getId().indexOf("index")>-1){M=K[i];}}I=B(P,M,true);if(!I&&P.indexOf("#")>0){var Q=P.substr(0,P.indexOf("#")-1);I=B(Q,M);}}sap.ui.getCore().applyChanges();this._sSelectedWorkSetItem=x.getSelectedWorksetItem();if(!s){window.location.hash=P;}if(!e){this._bIgnoreIFrameOnLoad=true;var R=P&&P.match(/\/sap\/me?\//);var U=P&&P.indexOf("sap/m/demokit")!==-1;var V=(R&&!U)?"?sap-ui-xx-fakeOS=ios":"";u.location.replace((P.indexOf("/")==0?"":this.sBasePathname)+P+V);}};f.THEMES={"sap_bluecrystal":"Blue Crystal","sap_goldreflection":"Gold Reflection","sap_hcb":"High Contrast Black"};f.prototype._handleThemeChanged=function(e){var n=e.getParameter("newValue");for(var x in f.THEMES){if(f.THEMES[x]==n){this._sTheme=x;this._applyTheme();e.getSource().getParent().close();break;}}};f.prototype._applyTheme=function(){var C=q("#content")[0].contentWindow;var I=this.calcRelativeUrl(C.location.href);var t=I?this.findIndexForPage(I):-1;if(I&&t>=0&&this._aTopLevelNavItems[t].themable&&C&&C.sap&&C.sap.ui&&C.sap.ui.getCore){var e=I.match(/\/sap\/me?\//);var m=e?["sap_bluecrystal"]:this._aThemes;var s=C.sap.ui.demokit&&C.sap.ui.demokit._supportedThemes?C.sap.ui.demokit._supportedThemes:m;var g=this._oThemeSwitch.getItems();for(var i=0;i<g.length;i++){g[i].setEnabled(q.inArray(g[i].getKey(),s)>=0);}if(q.inArray(this._sTheme,s)<0){this._sTheme=s[0];this._oThemeSwitch.setValue(f.THEMES[this._sTheme]);}C.sap.ui.getCore().applyTheme(this._sTheme);}};(function(){function r(o,s){if(o.ref&&o.resolve==="lib"){o.ref=s+o.ref;}if(o.links){for(var i=0;i<o.links.length;i++){r(o.links[i],s);}}}function m(n,o){if(n.key!=o.key||!o.links||o.links.length==0){return;}if(!n.links){n.links=o.links;return;}function e(h,k){for(var j=0;j<h.links.length;j++){if(h.links[j].key===k){return h.links[j];}}return null;}var s;for(var i=0;i<o.links.length;i++){s=o.links[i];if(!s.key){n.links.push(s);}else{var h=e(n,s.key);if(h){m(h,s);}else{n.links.push(s);}}}}function g(i,C,e,o){for(var j=0;j<e.length;j++){var h=o[e[j]];if(h&&h.docu){r(h.docu,h.libraryUrl);m(i,h.docu);}}C(i);}f.addReleaseNotesToDevGuide=function(I,u,t,e){if(!u){u="releasenotes.html";}if(!t){t="Release Notes";}if(!e){e=1;}function h(n){if(n&&n.links&&n.links.length>0){return n.links[0];}return null;}var o=I;for(var i=0;i<e;i++){o=h(o);}if(o){o.links=o.links||[];o.links.push({ref:u,text:t,alias:"releasenotes.html"});}return I;};f.extendDevGuide=function(I,C){q.sap.require("sap.ui.core.util.LibraryInfo");var h=new sap.ui.core.util.LibraryInfo();var u="discovery/all_libs";q.ajax({url:u,dataType:"json",error:function(x,s,e){q.sap.log.error("failed to load library list from '"+u+"': "+s+", "+e);C(I);},success:function(o,s,x){var e=o["all_libs"];if(!e){q.sap.log.error("failed to load library list from '"+u+"': "+s+", Data: "+e);C(I);return;}var j=0,k=e.length,n={},p=[],t;for(var i=0;i<k;i++){t=e[i].entry.replace(/\//g,".");p.push(t);h._getDocuIndex(t,function(E){n[E.library]=E;j++;if(j==k){g(I,C,p,n);}});}}});};})();return f;},true);
