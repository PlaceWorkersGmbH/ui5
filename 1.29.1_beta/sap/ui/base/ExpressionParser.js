/*!
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','jquery.sap.strings'],function(q){"use strict";
//License granted by Douglas Crockford to SAP, Apache License 2.0
//    (http://www.apache.org/licenses/LICENSE-2.0)
var u=f.bind(null,undefined),d={encodeURIComponent:encodeURIComponent,Math:Math,odata:{compare:function(){var O;q.sap.require("sap.ui.model.odata.ODataUtils");O=sap.ui.model.odata.ODataUtils;return O.compare.apply(O,arguments);},fillUriTemplate:function(){if(!URI.expand){q.sap.require("sap.ui.thirdparty.URITemplate");}return URI.expand.apply(URI,arguments).toString();},uriEncode:function(){var O;q.sap.require("sap.ui.model.odata.ODataUtils");O=sap.ui.model.odata.ODataUtils;return O.formatValue.apply(O,arguments);}},RegExp:RegExp},r=/\d/,a=/[a-z]\w*/i,b=/[a-z]/i,s={"BINDING":{led:j,nud:function(T,o){return B.bind(null,T.value);}},"IDENTIFIER":{led:j,nud:function(T,o){var G=o.globals[T.value];if(G===undefined){q.sap.log.warning("Unsupported global identifier '"+T.value+"' in expression parser input '"+o.input+"'",undefined,"sap.ui.base.ExpressionParser");}return f.bind(null,G);}},"CONSTANT":{led:j,nud:function(T,o){return f.bind(null,T.value);}},".":{lbp:18,led:function(T,o,l){return D.bind(null,l,o.advance("IDENTIFIER").value);},nud:j},"(":{lbp:17,led:function(T,o,l){var e=[],i=true;while(o.current().id!==")"){if(i){i=false;}else{o.advance(",");}e.push(o.expression(0));}o.advance(")");return F.bind(null,l,e);},nud:function(T,o){var v=o.expression(0);o.advance(")");return v;}},"[":{lbp:18,led:function(T,o,l){var n=o.expression(0);o.advance("]");return P.bind(null,l,n);},nud:function(T,o){var e=[],i=true;while(o.current().id!=="]"){if(i){i=false;}else{o.advance(",");}e.push(o.current().id===","?u:o.expression(0));}o.advance("]");return A.bind(null,e);}},"!":{lbp:15,led:j,nud:function(T,o){return U.bind(null,o.expression(this.lbp),function(x){return!x;});}},"typeof":{lbp:15,led:j,nud:function(T,o){return U.bind(null,o.expression(this.lbp),function(x){return typeof x;});}},"?":{lbp:4,led:function(T,o,l){var e,i;i=o.expression(this.lbp-1);o.advance(":");e=o.expression(this.lbp-1);return C.bind(null,l,i,e);},nud:j},")":{led:j,nud:j},"]":{led:j,nud:j},"{":{led:j,nud:function(T,o){var e=true,K,m={},v;while(o.current().id!=="}"){if(e){e=false;}else{o.advance(",");}if(o.current()&&o.current().id==="CONSTANT"&&typeof o.current().value==="string"){K=o.advance().value;}else{K=o.advance("IDENTIFIER").value;}o.advance(":");v=o.expression(0);m[K]=v;}o.advance("}");return M.bind(null,m);}},"}":{lbp:-1,led:j,nud:j},",":{led:j,nud:j},":":{led:j,nud:j}},t=["===","!==","!","||","&&",".","(",")","{","}",":",",","?","*","/","%","+","-","<=","<",">=",">","[","]"],c;t.forEach(function(T,i){t[i]=q.sap.escapeRegExp(T);});c=new RegExp(t.join("|"),"g");g("*",14,function(x,y){return x*y;});g("/",14,function(x,y){return x/y;});g("%",14,function(x,y){return x%y;});g("+",13,function(x,y){return x+y;}).nud=function(T,o){return U.bind(null,o.expression(this.lbp),function(x){return+x;});};g("-",13,function(x,y){return x-y;}).nud=function(T,o){return U.bind(null,o.expression(this.lbp),function(x){return-x;});};g("<=",11,function(x,y){return x<=y;});g("<",11,function(x,y){return x<y;});g(">=",11,function(x,y){return x>=y;});g(">",11,function(x,y){return x>y;});g("in",11,function(x,y){return x in y;});g("===",10,function(x,y){return x===y;});g("!==",10,function(x,y){return x!==y;});g("&&",7,function(x,y){return x&&y();},true);g("||",6,function(x,y){return x||y();},true);function A(e,l){var R=[];e.forEach(function(m,i){R[i]=m(l);});return R;}function B(i,e){return e[i];}function C(e,T,E,i){return e(i)?T(i):E(i);}function f(v){return v;}function D(l,i,e){var o=l(e),v=o[i];return typeof v==="function"?v.bind(o):v;}function F(l,e,m){var R=[];e.forEach(function(n,i){R[i]=n(m);});return l(m).apply(null,R);}function I(l,R,o,L,e){return o(l(e),L?R.bind(null,e):R(e));}function M(m,e){var K,R={};for(K in m){R[K]=m[K](e);}return R;}function P(l,n,e){return l(e)[n(e)];}function U(R,o,e){return o(R(e));}function g(i,e,o,l){s[i]={lbp:e,led:function(T,m,L){var n=l?this.lbp-1:this.lbp;return I.bind(null,L,m.expression(n),o,l);},nud:j};return s[i];}function h(m,i,e){var E=new SyntaxError(m);E.at=e;E.text=i;if(e!==undefined){m+=" at position "+e;}q.sap.log.error(m,i,"sap.ui.base.ExpressionParser");throw E;}function j(T){var e=T.input.slice(T.start,T.end);h("Unexpected "+T.id+(e!==T.id?": "+e:""),T.input,T.start+1);}function k(R,i,S){var l=[],t=[],T=q.sap._createJSTokenizer();function m(){var n,o,v,w,x;T.white();n=T.getCh();v=T.getIndex();if(b.test(n)){w=a.exec(i.slice(v));switch(w[0]){case"false":case"null":case"true":x={id:"CONSTANT",value:T.word()};break;case"in":case"typeof":x={id:w[0]};T.setIndex(v+w[0].length);break;default:x={id:"IDENTIFIER",value:w[0]};T.setIndex(v+w[0].length);}}else if(r.test(n)||n==="."&&r.test(i.charAt(T.getIndex()+1))){x={id:"CONSTANT",value:T.number()};}else if(n==="'"||n==='"'){x={id:"CONSTANT",value:T.string()};}else if(n==="$"){T.next("$");T.next("{");o=R(i,T.getIndex()-1);x={id:"BINDING",value:l.length};l.push(o.result);T.setIndex(o.at);}else{c.lastIndex=v;w=c.exec(i);if(!w||w.index!==v){return false;}x={id:w[0]};T.setIndex(v+w[0].length);}x.input=i;x.start=v;x.end=T.getIndex();t.push(x);return true;}T.init(i,S);try{while(m()){}}catch(e){if(e.name==="SyntaxError"){h(e.message,e.text,e.at);}else{throw e;}}return{at:T.getIndex(),parts:l,tokens:t};}function p(t,i,G){var e,n=0,o={advance:l,current:m,expression:v,globals:G,input:i},T;function l(E){var T=t[n];if(E){if(!T){h("Expected "+E+" but instead saw end of input",i);}else if(T.id!==E){h("Expected "+E+" but instead saw "+i.slice(T.start,T.end),i,T.start+1);}}n+=1;return T;}function m(){return t[n];}function v(w){var L;T=l();if(!T){h("Expected expression but instead saw end of input",i);}L=s[T.id].nud(T,o);while(n<t.length){T=m();if(w>=(s[T.id].lbp||0)){break;}l();L=s[T.id].led(T,o,L);}return L;}e=v(0);return{at:m()?m().start:undefined,formatter:e};}return{parse:function(R,i,S,G){var o,T;T=k(R,i,S);o=p(T.tokens,i,G||d);if(!T.parts.length){return{constant:o.formatter(),at:o.at||T.at};}function e(){return o.formatter(arguments);}e.textFragments=true;return{result:{formatter:e,parts:T.parts},at:o.at||T.at};}};},true);
