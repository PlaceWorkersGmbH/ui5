/*
 * SAP UI development toolkit for HTML5 (SAPUI5/OpenUI5)
 * (c) Copyright 2009-2015 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/base/ManagedObject','./ComponentMetadata','./Core','sap/ui/thirdparty/URI'],function(q,M,C,a,U){"use strict";function b(u,o){['sap-client','sap-server'].forEach(function(n){var v=u.get(n);if(v&&!o.hasSearch(n)){o.addSearch(n,v);}});}var c=M.extend("sap.ui.core.Component",{constructor:function(i,s){M.apply(this,arguments);},metadata:{stereotype:"component","abstract":true,version:"0.0",includes:[],dependencies:{libs:[],components:[],ui5version:""},config:{},customizing:{},library:"sap.ui.core"}},C);c.activateCustomizing=function(s){};c.deactivateCustomizing=function(s){};c.getOwnerIdFor=function(o){var O=(o instanceof M)&&o._sOwnerId;return O||undefined;};c.getOwnerComponentFor=function(o){var O=c.getOwnerIdFor(o);return O&&sap.ui.component(O);};c.prototype.runAsOwner=function(f){var o=M._sOwnerId;try{M._sOwnerId=this.getId();return f.call();}finally{M._sOwnerId=o;}};c.prototype.getInterface=function(){return this;};c.prototype._initCompositeSupport=function(s){this._mManifestModels={};this.getMetadata().onInitComponent();this.oComponentData=s&&s.componentData;this.getMetadata().init();this.initComponentModels();if(this.onWindowError){this._fnWindowErrorHandler=q.proxy(function(e){var E=e.originalEvent;this.onWindowError(E.message,E.filename,E.lineno);},this);q(window).bind("error",this._fnWindowErrorHandler);}if(this.onWindowBeforeUnload){this._fnWindowBeforeUnloadHandler=q.proxy(this.onWindowBeforeUnload,this);q(window).bind("beforeunload",this._fnWindowBeforeUnloadHandler);}if(this.onWindowUnload){this._fnWindowUnloadHandler=q.proxy(this.onWindowUnload,this);q(window).bind("unload",this._fnWindowUnloadHandler);}};c.prototype.destroy=function(){if(typeof this._mManifestModels==='object'){for(var m in this._mManifestModels){this._mManifestModels[m].destroy();}this._mManifestModels=null;}if(this._fnWindowErrorHandler){q(window).unbind("error",this._fnWindowErrorHandler);delete this._fnWindowErrorHandler;}if(this._fnWindowBeforeUnloadHandler){q(window).unbind("beforeunload",this._fnWindowBeforeUnloadHandler);delete this._fnWindowBeforeUnloadHandler;}if(this._fnWindowUnloadHandler){q(window).unbind("unload",this._fnWindowUnloadHandler);delete this._fnWindowUnloadHandler;}if(this._oEventBus){this._oEventBus.destroy();delete this._oEventBus;}M.prototype.destroy.apply(this,arguments);sap.ui.getCore().getMessageManager().unregisterObject(this);this.getMetadata().onExitComponent();};c.prototype.getComponentData=function(){return this.oComponentData;};c.prototype.getEventBus=function(){if(!this._oEventBus){q.sap.require("sap.ui.core.EventBus");this._oEventBus=new sap.ui.core.EventBus();}return this._oEventBus;};c.prototype.initComponentModels=function(){var m=this.getMetadata();var A=m.getManifestEntry("sap.app");var u=m.getManifestEntry("sap.ui5");var d=u&&u["models"];if(!d){return;}var D=(A&&A["dataSources"])?A["dataSources"]:null;var o=q.sap.getUriParameters();for(var s in d){var e=d[s];if(typeof e==='string'){e={dataSource:e};}if(e.dataSource){var f=D&&D[e.dataSource];if(typeof f==='object'){if(f.type===undefined){f.type='OData';}if(!e.type){switch(f.type){case'OData':e.type='sap.ui.model.odata.v2.ODataModel';break;case'JSON':e.type='sap.ui.model.json.JSONModel';break;case'XML':e.type='sap.ui.model.xml.XMLModel';break;default:}}if(!e.uri){e.uri=f.uri;}if(f.type==='OData'&&f.settings&&f.settings.annotations){var g=f.settings.annotations;for(var i=0;i<g.length;i++){var h=D[g[i]];if(!h){q.sap.log.error("Component Manifest: ODataAnnotation \""+g[i]+"\" for dataSource \""+e.dataSource+"\" could not be found in manifest","[\"sap.app\"][\"dataSources\"][\""+g[i]+"\"]",this);continue;}if(h.type!=='ODataAnnotation'){q.sap.log.error("Component Manifest: dataSource \""+g[i]+"\" was expected to have type \"ODataAnnotation\" but was \""+h.type+"\"","[\"sap.app\"][\"dataSources\"][\""+g[i]+"\"]",this);continue;}if(!h.uri){q.sap.log.error("Component Manifest: Missing \"uri\" for ODataAnnotation \""+g[i]+"\"","[\"sap.app\"][\"dataSources\"][\""+g[i]+"\"]",this);continue;}var j=m._resolveUri(new U(h.uri)).toString();e.settings=e.settings||{};e.settings.annotationURI=e.settings.annotationURI||[];e.settings.annotationURI.push(j);}}}else{q.sap.log.error("Component Manifest: dataSource \""+e.dataSource+"\" for model \""+s+"\" not found or invalid","[\"sap.app\"][\"dataSources\"][\""+e.dataSource+"\"]",this);}}if(!e.type){q.sap.log.error("Component Manifest: Missing \"type\" for model \""+s+"\"","[\"sap.ui5\"][\"models\"][\""+s+"\"]",this);continue;}try{q.sap.require(e.type);}catch(E){q.sap.log.error("Component Manifest: Class \""+e.type+"\" for model \""+s+"\" could not be loaded. "+E,"[\"sap.ui5\"][\"models\"][\""+s+"\"]",this);continue;}var k=q.sap.getObject(e.type);if(!k){q.sap.log.error("Component Manifest: Class \""+e.type+"\" for model \""+s+"\" could not be found","[\"sap.ui5\"][\"models\"][\""+s+"\"]",this);continue;}if(e.type==='sap.ui.model.odata.ODataModel'&&(!e.settings||e.settings.json===undefined)){e.settings=e.settings||{};e.settings.json=true;}if(e.uri){var l=new U(e.uri);l=m._resolveUri(l);if(e.dataSource){b(o,l);}e.uri=l.toString();}if(e.uriSettingName===undefined){switch(e.type){case'sap.ui.model.odata.ODataModel':case'sap.ui.model.odata.v2.ODataModel':e.uriSettingName='serviceUrl';break;case'sap.ui.model.resource.ResourceModel':e.uriSettingName='bundleUrl';break;default:}}if(e.uri){if(e.uriSettingName!==undefined){e.settings=e.settings||{};if(!e.settings[e.uriSettingName]){e.settings[e.uriSettingName]=e.uri;}}else if(e.settings){e.settings=[e.uri,e.settings];}else{e.settings=[e.uri];}}if(e.settings&&!q.isArray(e.settings)){e.settings=[e.settings];}var n=[null].concat(e.settings||[]);var F=k.bind.apply(k,n);var p=new F();this._mManifestModels[s]=p;this.setModel(p,s||undefined);}};sap.ui.component=function(v){if(!v){throw new Error("sap.ui.component cannot be called without parameter!");}if(typeof v==='string'){return sap.ui.getCore().getComponent(v);}function d(o){var n=v.name,i=v.id,f=v.componentData,s=n+'.Component',S=v.settings;var I=new o(q.extend({},S,{id:i,componentData:f}));q.sap.log.info("Component instance Id = "+I.getId());var h=I.getMetadata().handleValidation()!==undefined||v.handleValidation;if(h){if(I.getMetadata().handleValidation()!==undefined){h=I.getMetadata().handleValidation();}else{h=v.handleValidation;}sap.ui.getCore().getMessageManager().registerObject(I,h);}return I;}var e=sap.ui.component.load(v,true);if(v.async){return e.then(d);}else{return d(e);}};sap.ui.component.load=function(o,f){var n=o.name,u=o.url,d=/^(sync|async)$/.test(sap.ui.getCore().getConfiguration().getComponentPreload());if(!n){throw new Error("The name of the component is undefined.");}if(u){q.sap.registerModulePath(n,u);}function g(){var s=n+'.Component';q.sap.require(s);var e=q.sap.getObject(s);if(!e){var m="The specified component controller '"+s+"' could not be found!";if(f){throw new Error(m);}else{q.sap.log.warning(m);}}return e;}function r(O){if(typeof O==='object'){if(O.url){q.sap.registerModulePath(O.name,O.url);}return O.name;}return O;}function p(s,A){var i=s+'.Component',P;if(d&&!q.sap.isDeclared(i,true)){if(A){P=q.sap.getResourceName(i,'-preload.js');return q.sap._loadJSResourceAsync(P,true);}try{P=i+'-preload';q.sap.require(P);}catch(e){q.sap.log.warning("couldn't preload component from "+P+": "+((e&&e.message)||e));}}}if(o.async){var h=o.asyncHints||{},j=[],k=function(P){if(P){j.push(P);}};if(h.libs){k(sap.ui.getCore().loadLibraries(h.libs.map(r)));}if(d){k(p(n,true));if(h.components){q.each(h.components,function(i,v){k(p(r(v),true));});}}return Promise.all(j).then(function(v){q.sap.log.debug("Component.load: all promises fulfilled, then "+v);return g();});}p(n);return g();};return c;},true);
